<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <!--    <meta content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no" name="viewport">-->
    <title>Pin-Table</title>

    <!-- General CSS Files -->
    <link rel="stylesheet" href="/css/modules/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/modules/fontawesome/css/all.min.css">

    <!-- CSS Libraries -->

    <!-- Template CSS -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/components.css">

    <!-- Start Naver API -->
    <script type="text/javascript"
            src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=i3qv4ecus5"></script>
    <script type="text/javascript"
            src="https://openapi.map.naver.com/openapi/v3/maps.js?clientId=i3qv4ecus5&submodules=geocoder"></script>


    <!-- Js Files -->
    <script src="/js/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!--head ÌÉúÍ∑∏ ÎÇ¥ Ï∂îÍ∞Ä-->
    <link rel="icon" href="/css/images/pin.png">

</head>

<body>
<div id="app">
    <div class="main-wrapper main-wrapper-1">
        <div class="navbar-bg"></div>
        <nav class="navbar navbar-expand-lg main-navbar">
            <form class="form-inline mr-auto">
                <ul class="navbar-nav mr-3">
                    <li><a href="#" data-toggle="sidebar" class="nav-link nav-link-lg"><img
                            src="/css/images/pin.png" alt="My Image"></a>
                    </li>
                    <li><a href="#" data-toggle="search" class="nav-link nav-link-lg d-sm-none"><i
                            class="fas fa-search"></i></a></li>
                </ul>
                <div class="search-element">
                    <form action="/api/search" method="get">
                        <select id="category">
                            <optgroup label="=== Í≤ÄÏÉâÏñ¥ ÏßÄÏ†ï ===">
                                <option name="test" value="/api/search/storeName/?storeName=">Í∞ÄÍ≤å Ïù¥Î¶Ñ ÏùºÏπò</option>
                                <option name="test" value="/api/search/storeNameInclude/?storeNameInclude=">Í∞ÄÍ≤å Ïù¥Î¶Ñ
                                </option>
                                <option name="test" value="/api/search/roadAddressInclude/?roadNameAddress=">ÎèÑÎ°úÎ™Ö Ï£ºÏÜå
                                </option>
                                <option name="test" value="/api/search/Business/?typeOfBusiness=">ÏóÖÏ¢Ö</option>
                                <option name="test" value="/api/search/ReviewHigh/">Î¶¨Î∑∞ nÍ∞úÏù¥ÏÉÅ</option>
                                <option name="test" value="/api/search/ReviewLow/">Î¶¨Î∑∞ nÍ∞úÏù¥Ìïò</option>
                                <option name="test" value="/api/search/StarScoreHigh/">ÌèâÏ†ê nÏ†êÏù¥ÏÉÅ</option>
                                <option name="test" value="/api/search/StarScoreLow/">ÌèâÏ†ê nÏ†êÏù¥Ìïò</option>
                            </optgroup>
                            <optgroup label="=== Í≤ÄÏÉâÏñ¥ ÏóÜÏù¥ ===">
                                <option name="test" value="/api/search/ReviewASC">Î¶¨Î∑∞ Ï†ÅÏùÄÏàú</option>
                                <option name="test" value="/api/search/ReviewDESC">Î¶¨Î∑∞ ÎßéÏùÄÏàú</option>
                                <option name="test" value="/api/search/StarScoreASC">ÌèâÏ†ê ÎÇÆÏùÄÏàú</option>
                                <option name="test" value="/api/search/StarScoreDESC">ÌèâÏ†ê ÎÜíÏùÄÏàú</option>
                            </optgroup>
                        </select>
                        <input class="form-control" type="search" placeholder="Search" aria-label="Search" width="1200"
                               name="storeName">

                        <script>
                            function handleSearch() {
                                let query = document.querySelector('.form-control').value;
                                let test = document.getElementById("category");
                                let value = (category.options[test.selectedIndex].value);

                                // window.location = "/api/searchLocation?storeName=" + query;
                                window.location = value + query;
                            }
                        </script>


                        <button type="button" class="btn btn-primary" onclick=handleSearch()>Search</button>
                        <button class="btn btn-primary" id="btn5" type="button">ÌòÑÏúÑÏπò</button>
                        <script th:inline="javascript">
                            let latitude = "", longitude = "";

                            document.getElementById("btn5").onclick = function () {
                                navigator.geolocation.getCurrentPosition(onSuccess, onError);
                            }
                        </script>
                    </form>
                    <div class="search-backdrop"></div>
                </div>
                <div class="search-element">
                </div>
            </form>
            <ul class="navbar-nav navbar-right">
                <li class="dropdown"><a href="#" data-toggle="dropdown"
                                        class="nav-link dropdown-toggle nav-link-lg nav-link-user">
                    <img alt="image" src="/css/images/avatar.png" class="rounded-circle mr-1">
                </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item has-icon text-danger">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </li>
            </ul>
        </nav>
        <div class="main-sidebar sidebar-style-2">
            <aside id="sidebar-wrapper">
                <div class="sidebar-brand">
                    <a href="index.html">Pin-Table</a>
                </div>
                <div class="sidebar-brand sidebar-brand-sm">
                    <a href="index.html">üîô</a>
                </div>
                <ul class="sidebar-menu">
                    <p></p>
                    <p></p>
                    <li class="dropdown active">
                        <a class="nav-link"><span>Stores</span></a>
                    </li>
                    <p></p>
                    <p></p>
                    <p></p>
                    <div class="image-box">
                        <img alt="image" src="/css/images/shopping-mall.png" class="rounded-circle mr-1" width="240"
                             style="border-radius:50%"/>
                    </div>
                    <li class="store">
                        <p><span id="storename"></span></p>
                    </li>
                    <li class="store">
                        <p><span id="id" hidden></span></p>
                    </li>
                    <p></p>
                    <li class="store-posting">
                        <p><img alt="image" src="/css/images/pin.png" width="32"
                                style="border-radius:50%"><span id="storeadrress"></span></p>
                        <p></p>
                    </li>
                    <li class="store-posting">
                        <div id="storeStatus">
                            <div id="storeStatusShow">
                                <p> ÎåÄÍ∏∞ ÌòÑÌô© : </p>
                            </div>
                            <div id="myStatusShow">
                                <p> ÎÇ¥ Ïõ®Ïù¥ÌåÖ ÌòÑÌô© : </p>
                            </div>
                            <P></P>
                            <button type="button" class="btn1" id="requestwaiting" onclick="waiting()"> ÎåÄÍ∏∞ ÏöîÏ≤≠</button>
                            <!--                            <button type="button" class="btn1" id="canclewaiting" onclick="cancle()"> ÎåÄÍ∏∞ Ï∑®ÏÜå</button>-->
                            <button type="button" class="btn1" id="Confirmstatus" onclick="status()"> ÏÉÅÌÉú Ï°∞Ìöå</button>
                        </div>
                    </li>
                    <p></p>
                    <li class="waiting-login">
                        <div class="signin" id="signin">
                            <script></script>
                            <a><span>ÎåÄÍ∏∞ Ïã†Ï≤≠</span></a>
                            <div class="input-box">
                                <input class="userId" type="username" placeholder="id" style="height: 30px">
                            </div>
                            <div class="input-box">
                                <input class="password" type="password" placeholder="password" style="height: 30px">
                            </div>
                            <p></p>
                            <button type="button" id="loginbtn" style="color: white; background: black;"
                                    onclick="signIn();"> join
                            </button>
                            <button type="button" id="confirmbtn" style="color: white; background: black;"
                                    onclick="callWaiting()"> cofirm
                            </button>
                        </div>
                    </li>
                    <li class="mystatus">
                        <div class="cancle" id="statusConfirm">
                            <script></script>
                            <a><span>ÎÇ¥ ÏÉÅÌÉú Ï°∞Ìöå</span></a>
                            <div class="input-box">
                                <input class="userId1" type="username" placeholder="id" style="height: 30px">
                            </div>
                            <button type="button" id="statusbtn" style="color: white; background: black;"
                                    onclick="mystatus()"> Confirm
                            </button>
                        </div>
                    </li>
                </ul>
                <div class="sidebar-brand sidebar-brand-sm">

                </div>
            </aside>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <section class="section">
                <div class="section-body">
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row mb-4">
                                        <div class="col-4 col-12 col-md-6 col-lg-4">
                                            <form id="search-form">
                                            </form>
                                        </div>
                                    </div>
                                    <div id="map" style="width:100%;height:1100px;"></div>
                                    <input type="hidden" name="username" value="..." id="username"/>
                                    <script th:inline="javascript">
                                        const searchList = [[${searchList}]];
                                        console.log(searchList)
                                        console.log("Ìò∏Ï∂ú")
                                        // ÏòàÏô∏Ï≤òÎ¶¨ : Í≤ÄÏÉâÍ≤∞Í≥º ÏóÜÏùå
                                        if (!searchList) {
                                            const map = new naver.maps.Map('map', {
                                                center: new naver.maps.LatLng([[${Lat}]], [[${Lng}]]),
                                                zoom: 16
                                            });

                                            const marker = new naver.maps.Marker({
                                                icon: {
                                                    url: "/css/images/pin.png",
                                                    scaledSize: new naver.maps.Size(30, 37),
                                                    origin: new naver.maps.Point(0, 0),
                                                },
                                                position: new naver.maps.LatLng([[${Lat}]], [[${Lng}]]),
                                                map: map
                                            });

                                            // content open Ïù¥Î≤§Ìä∏
                                            naver.maps.Event.addListener(marker, "click", function (e) {
                                                if (infowindow.getMap()) {
                                                    infowindow.close();
                                                } else {
                                                    infowindow.open(map, marker);
                                                }
                                            });

                                        } else {
                                            // map Ï¢åÌëú ÏßÄÏ†ï
                                            const searchNum = searchList.length;
                                            const map = new naver.maps.Map('map', {
                                                center: new naver.maps.LatLng(searchList[0].xcoordinate, searchList[0].ycoordinate),
                                                zoom: 16
                                            });

                                            for (let i = 0; i < searchNum; i++) {
                                                const {
                                                    xcoordinate,
                                                    ycoordinate,
                                                    storeName,
                                                    roadNameAddress,
                                                    storeId
                                                } = searchList[i];
                                                // ÎßàÏª§ ÏÉùÏÑ±
                                                const marker = new naver.maps.Marker({
                                                    icon: {
                                                        url: "/css/images/pin.png",
                                                        scaledSize: new naver.maps.Size(30, 37),
                                                        origin: new naver.maps.Point(0, 0),
                                                    },
                                                    position: new naver.maps.LatLng(xcoordinate, ycoordinate),
                                                    map: map
                                                });

                                                // Í≤ÄÏÉâ Í≤∞Í≥º content
                                                const contentString = [
                                                    '<div class="iw_inner" style="padding:5px; margin: 5px 5px 5px 5px; width: 150px; height: 45px; text-align: center; ">',
                                                    `<p>üè† ${storeName}</p>`, // index
                                                    `<p>${roadNameAddress}</p>`, // index
                                                    '</div>'
                                                ].join('').replace(/\"/gi, "");

                                                const infowindow = new naver.maps.InfoWindow({
                                                    content: contentString,
                                                    maxWidth: 200,
                                                    height: 50,
                                                    backgroundColor: "white",
                                                    borderColor: "black",
                                                    borderWidth: 1,
                                                    disableAnchor: true,
                                                    textAlign: "center",
                                                    margin: "auto",

                                                    pixelOffset: new naver.maps.Point(0, -5)
                                                });

                                                // content open Ïù¥Î≤§Ìä∏
                                                naver.maps.Event.addListener(marker, "click", function (e) {
                                                    if (infowindow.getMap()) {
                                                        infowindow.close();
                                                    } else {
                                                        infowindow.open(map, marker);
                                                        document.getElementById("storename").innerHTML = storeName;
                                                        document.getElementById("storeadrress").innerHTML = roadNameAddress;
                                                        document.getElementById("id").innerHTML = storeId;
                                                    }
                                                });
                                            }
                                        }
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <footer class="main-footer">
            <div class="footer-right">
            </div>
        </footer>
    </div>
</div>
</body>
</html>


